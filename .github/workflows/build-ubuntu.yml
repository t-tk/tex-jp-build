name: Build on ubuntu
run-name: ${{ github.actor }} is building and testing on ubuntu
on:
  push:
    branches:
      - 'build/ubuntu/*'
jobs:
  Build-on-ubuntu:
    runs-on: ubuntu-latest
    timeout-minutes: 40
    steps:
      - run: echo "üéâ The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "üêß This job is now running on a ${{ runner.os }} server hosted by GitHub."
      - run: echo "Branch [ ${{ github.ref }} ]  Repository [ ${{ github.repository }} ]"
      - name: Check out repository code
        uses: actions/checkout@v3

      - name: make libs
        shell: bash
        run: |
          mkdir -p ./source/Work/libs/{zlib,libpng}
          cd ${{ github.workspace }}/source/Work/libs/zlib
          ../../../libs/zlib/configure
          make
          make check
          cd ${{ github.workspace }}/source/Work/libs/libpng
          ../../../libs/libpng/configure
          make
          make check

      - name: make kpathsea, ptexenc
        shell: bash
        run: |
          mkdir -p ./source/Work/texk/{kpathsea,ptexenc}
          cd ${{ github.workspace }}/source/Work/texk/kpathsea
          ../../../texk/kpathsea/configure
          make
          make check
          cd ${{ github.workspace }}/source/Work/texk/ptexenc
          ../../../texk/ptexenc/configure
          make

      - name: dviout-util
        shell: bash
        run: |
          mkdir -p ./source/Work/texk/dviout-util
          cd ./source/Work/texk/dviout-util
          ../../../texk/dviout-util/configure
          make
          make check

      - run: echo "‚õÑ This job's status is ${{ job.status }}."
