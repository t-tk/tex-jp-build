name: Build on ubuntu
run-name: ${{ github.actor }} is building and testing on ubuntu
on:
  push:
    branches:
      - 'build/ubuntu/*'
jobs:
  Build-on-ubuntu:
    runs-on: ubuntu-latest
    timeout-minutes: 40
    steps:
      - run: echo "🎉 The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "🐧 This job is now running on a ${{ runner.os }} server hosted by GitHub."
      - run: echo "Branch [ ${{ github.ref }} ]  Repository [ ${{ github.repository }} ]"
      - name: Check out repository code
        uses: actions/checkout@v3

      - name: make libs
        shell: bash
        run: |
          mkdir -p ./source/Work/libs/{zlib,libpng}
          cd ${{ github.workspace }}/source/Work/libs/zlib
          ../../../libs/zlib/configure
          make
          make check
          cd ${{ github.workspace }}/source/Work/libs/libpng
          ../../../libs/libpng/configure
          make
          make check

      - name: make kpathsea, ptexenc
        shell: bash
        run: |
          mkdir -p ./source/Work/texk/{kpathsea,ptexenc}
          cd ${{ github.workspace }}/source/Work/texk/kpathsea
          ../../../texk/kpathsea/configure
          make
          make check
          cd ${{ github.workspace }}/source/Work/texk/ptexenc
          ../../../texk/ptexenc/configure
          make

      - name: dvipsk
        shell: bash
        run: |
          mkdir -p ./source/Work/texk/dvipsk
          cd ./source/Work/texk/dvipsk
          ../../../texk/dvipsk/configure
          make
          make check

      - name: makejvf
        shell: bash
        run: |
          mkdir -p ./source/Work/texk/makejvf
          cd ./source/Work/texk/makejvf
          ../../../texk/makejvf/configure
          make
          make check

      - name: mendex
        shell: bash
        run: |
          mkdir -p ./source/Work/texk/mendexk
          cd ./source/Work/texk/mendexk
          ../../../texk/mendexk/configure
          make
          make check

      - name: dviout-util
        shell: bash
        run: |
          mkdir -p ./source/Work/texk/dviout-util
          cd ./source/Work/texk/dviout-util
          ../../../texk/dviout-util/configure
          make
          make check

      - name: dvi2tty
        shell: bash
        run: |
          mkdir -p ./source/Work/texk/dvi2tty
          cd ./source/Work/texk/dvi2tty
          ../../../texk/dvi2tty/configure
          make
          make check

      - name: seetex
        shell: bash
        run: |
          mkdir -p ./source/Work/texk/seetexk
          cd ./source/Work/texk/seetexk
          ../../../texk/seetexk/configure
          make
          make check

      - name: dvidvi
        shell: bash
        run: |
          mkdir -p ./source/Work/texk/dvidvi
          cd ./source/Work/texk/dvidvi
          ../../../texk/dvidvi/configure
          make
          make check

      - name: web2c
        shell: bash
        run: >
          mkdir -p ./source/Work/texk/web2c ;
          cd ./source/Work/texk/web2c ;
          ../../../texk/web2c/configure
            --srcdir=../../../texk/web2c
            --enable-ptex
            --enable-eptex
            --enable-uptex
            --enable-euptex
            --disable-pmp
            --disable-upmp
            --disable-ptex-synctex
            --disable-eptex-synctex
            --disable-uptex-synctex
            --disable-euptex-synctex
            --disable-pdftex
            --disable-pdftex-synctex
            --disable-mf
            --disable-mf-nowin
            --disable-tex
            --disable-tex-synctex
            --disable-etex
            --disable-etex-synctex
            --disable-aleph
            --disable-luatex
            --disable-luajittex
            --disable-mp
            --disable-xetex
            --disable-xetex-synctex
            --disable-mflua
            --disable-mfluajit
            --disable-epsfwin
            --disable-hp2627win
            --disable-mftalkwin
            --disable-nextwin
            --disable-regiswin
            --disable-suntoolswin
            --disable-tektronixwin
            --disable-unitermwin
            --disable-web-progs
            --disable-synctex
            --disable-missing
            --with-gnu-ld
            --without-x
            --without-mf-x-toolkit
            --without-system-kpathsea
            --without-system-ptexenc
            --without-system-zlib
            --without-system-libpng
            --without-system-freetype2
            --without-system-pixman
            --without-system-cairo
            --without-system-gmp
            --without-system-mpfr
            --without-system-poppler
            --without-system-xpdf
            --without-system-zziplib
            --without-system-teckit
            --without-system-icu
            --without-system-graphite2
            --without-system-harfbuzz ;
          make ;
          make check

      - run: echo "⛄ This job's status is ${{ job.status }}."
