#! /bin/sh -vx
# $Id$
# Copyright 2023 Andreas Scherer <tex-live@tug.org>
# You may freely use, modify and/or distribute this file.

BinDir=${BinDir:-.}
ExeExt=${ExeExt:-}
_ctwill=$BinDir/ctwill$ExeExt
_ctwill_refsort=$BinDir/ctwill-refsort$ExeExt
_ctwill_twinx=$BinDir/ctwill-twinx$ExeExt

testdir=$srcdir/cwebdir/tests

# Test CTWILL by running it twice
CWEBINPUTS=$testdir $_ctwill ham ham || exit 1
CWEBINPUTS=$testdir $_ctwill ham ham || exit 1
diff ham.tex $testdir/ham.tex || exit 1

# Test CTWILL-REFSORT
$_ctwill_refsort < $testdir/ham.ref > ham.sref || exit 1
diff ham.sref $testdir/ham.sref || exit 1

# Test CTWILL-TWINX
$_ctwill_twinx ham.tex > index.tex
diff index.tex $testdir/index.tex || exit 1

# Test CTWILL-PROOFSORT
# Perl script not available in builddir, and requires Unicode::Collate;
# if that module is not available, just quit testing.
perl -e 'use Unicode::Collate;' 2>/dev/null || exit 0
$testdir/../ctwill-proofsort ham.tex > ham-sorted.tex || exit 1
diff ham-sorted.tex $testdir/ham-sorted.tex || exit 1

exit 0
