#! /bin/sh -vx
# $Id$
# Copyright 2022-2023 TANAKA Takuji <ttk@t-lab.opal.ne.jp>
# You may freely use, modify and/or distribute this file.

test -d tests || mkdir tests
test -d tests || exit 1

LC_ALL=C; export LC_ALL; LANGUAGE=C; export LANGUAGE
#
TEXMFCNF=.; export TEXMFCNF
BSTINPUTS=$srcdir/tests; export BSTINPUTS
BIBINPUTS=$srcdir/tests; export BIBINPUTS

bin=${bin:-.}
exe=${exe:-}
_bibtexu=$bin/bibtexu$exe

$bin/kpsewhich$exe texmf.cnf

$bin/kpsewhich$exe teststyle.bst
$bin/kpsewhich$exe -format=bst teststyle.bst

$bin/kpsewhich$exe testsortu.bib
$bin/kpsewhich$exe -format=bib testsortu.bib

echo $srcdir

printenv BSTINPUTS

rm -f tests/xsortu-*.bbl tests/xcaseu.bbl

rc=0

$_bibtexu --version

for loc in en az da fi tr; do

## test for sorting and change.case$
cp $srcdir/tests/sortu.aux tests/xsortu-$loc.aux
$_bibtexu -o $loc tests/xsortu-$loc || rc=1
diff $srcdir/tests/sortu-$loc.bbl tests/xsortu-$loc.bbl || rc=2

done

max_print_line=99
export max_print_line

## test for change.case$
#cp $srcdir/tests/caseu.aux tests/xcaseu.aux
#max_print_line=99 $_bibtexu tests/xcaseu || rc=3
#diff $srcdir/tests/caseu.bbl tests/xcaseu.bbl || rc=4

exit $rc
